(function(undefined){"use strict";function Supervisor(sigInst,options){var _this=this,workerFn=sigInst.getForceAtlas2Worker();if(window.URL=window.URL||window.webkitURL,this.sigInst=sigInst,this.graph=this.sigInst.graph,this.ppn=10,this.ppe=3,this.started=!1,this.running=!1,webWorkers){var blob=this.makeBlob(workerFn);this.worker=new Worker(URL.createObjectURL(blob)),this.worker.postMessage=this.worker.webkitPostMessage||this.worker.postMessage}else eval(workerFn);var msgName=this.worker?"message":"newCoords";(this.worker||document).addEventListener(msgName,function(a){_this.nodesByteArray=new Float32Array(a.data.nodes),_this.applyLayoutChanges(),_this.running&&_this.sendByteArrayToWorker(),_this.sigInst.refresh()}),this.graphToByteArrays()}if("undefined"==typeof sigma)throw"sigma is not declared";var webWorkers="Worker"in window;Supervisor.prototype.makeBlob=function(a){var b;try{b=new Blob([a],{type:"application/javascript"})}catch(c){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,b=new BlobBuilder,b.append(a),b=b.getBlob()}return b},Supervisor.prototype.graphToByteArrays=function(){var a,b,c,d=this.graph.nodes(),e=this.graph.edges(),f=d.length*this.ppn,g=e.length*this.ppe,h={};for(this.nodesByteArray=new Float32Array(f),this.edgesByteArray=new Float32Array(g),a=b=0,c=d.length;c>a;a++)h[d[a].id]=b,this.nodesByteArray[b]=d[a].x,this.nodesByteArray[b+1]=d[a].y,this.nodesByteArray[b+2]=0,this.nodesByteArray[b+3]=0,this.nodesByteArray[b+4]=0,this.nodesByteArray[b+5]=0,this.nodesByteArray[b+6]=1+this.graph.degree(d[a].id),this.nodesByteArray[b+7]=1,this.nodesByteArray[b+8]=d[a].size,this.nodesByteArray[b+9]=0,b+=this.ppn;for(a=b=0,c=e.length;c>a;a++)this.edgesByteArray[b]=h[e[a].source],this.edgesByteArray[b+1]=h[e[a].target],this.edgesByteArray[b+2]=e[a].weight||0,b+=this.ppe},Supervisor.prototype.applyLayoutChanges=function(){for(var a=this.graph.nodes(),b=0,c=0,d=this.nodesByteArray.length;d>c;c+=this.ppn)a[b].x=this.nodesByteArray[c],a[b].y=this.nodesByteArray[c+1],b++},Supervisor.prototype.sendByteArrayToWorker=function(a){var b={action:a||"loop",nodes:this.nodesByteArray.buffer},c=[this.nodesByteArray.buffer];"start"===a&&(b.config={},b.edges=this.edgesByteArray.buffer,c.push(this.edgesByteArray.buffer)),webWorkers?this.worker.postMessage(b,c):window.postMessage(b,"*")},Supervisor.prototype.start=function(){this.running||(this.running=!0,this.started?this.sendByteArrayToWorker():(this.sendByteArrayToWorker("start"),this.started=!0))},Supervisor.prototype.stop=function(){this.running&&(this.running=!1)},Supervisor.prototype.killWorker=function(){this.worker.terminate()};var supervisor=null;sigma.prototype.startForceAtlas2=function(){return supervisor||(supervisor=new Supervisor(this)),supervisor.start(),this},sigma.prototype.stopForceAtlas2=function(){return supervisor.stop(),this},sigma.prototype.killForceAtlas2=function(){return supervisor.stop(),supervisor.killWorker(),supervisor=null,this}}).call(this),function(){"use strict";function a(a){var b,c,d,e=["x","y","dx","dy","old_dx","old_dy","mass","convergence","size","fixed"],f=["source","target","weight"];for(c=0,d=e.length;d>c;c++)b=new RegExp("np\\(([^,]*), '"+e[c]+"'\\)","g"),a=a.replace(b,0===c?"$1":"$1 + "+c);for(c=0,d=f.length;d>c;c++)b=new RegExp("ep\\(([^,]*), '"+f[c]+"'\\)","g"),a=a.replace(b,0===c?"$1":"$1 + "+c);return a}if("undefined"==typeof sigma)throw"sigma is not declared";var b=function(){function a(a,b){if(a%g.ppn!==0)throw"np: non correct ("+a+").";if(a!==parseInt(a))throw"_np: non int.";if(b in h)return a+h[b];throw"ForceAtlas2.Worker - Inexistant node property given ("+b+")."}function b(a,b){if(a%g.ppe!==0)throw"ep: non correct ("+a+").";if(a!==parseInt(a))throw"ep: non int.";if(b in i)return a+i[b];throw"ForceAtlas2.Worker - Inexistant edge property given ("+b+")."}function c(a,b){g.nodeMatrix=a,g.edgeMatrix=b,g.nodesLength=g.nodeMatrix.length,g.edgesLength=g.edgeMatrix.length}function d(){var c,d,e,f,h,i,j,k,l,m,n,o,p,q,r;for(e=0;e<g.nodesLength;e+=g.ppn)g.nodeMatrix[a(e,"old_dx")]=g.nodeMatrix[a(e,"dx")],g.nodeMatrix[a(e,"old_dy")]=g.nodeMatrix[a(e,"dy")],g.nodeMatrix[a(e,"dx")]=0,g.nodeMatrix[a(e,"dy")]=0;if(g.settings.outboundAttractionDistribution){for(l=0,e=0;e<g.nodesLength;e+=g.ppn)l+=g.nodeMatrix[a(e,"mass")];l/=g.nodesLength}if(g.settings.barnesHutOptimize){var s,t,u=Math.pow(2,2*g.settings.barnesHutDepthLimit),v=Math.pow(2,g.settings.barnesHutDepthLimit),w=new UInt16Array(u),x=(new Float32Array(u*g.ppq),new UInt16Array(u)),y=(new UInt16Array(u),new UInt16Array(g.nodesLength)),z=(new UInt16Array(g.nodesLength),0),A=0,B=0,C=0;for(e=0;e<g.nodesLength;e+=g.ppn)z=Math.max(z,g.nodeMatrix[a(e,"x")]),B=Math.min(B,g.nodeMatrix[a(e,"x")]),A=Math.max(A,g.nodeMatrix[a(e,"y")]),C=Math.min(C,g.nodeMatrix[a(e,"y")]);for(z+=1e-4*(z-B),A+=1e-4*(A-C),e=0,d=0;e<g.nodesLength;e+=g.ppn,d++)s=(g.nodeMatrix[a(e,"x")]-B)/(z-B)*Math.pow(2,g.settings.barnesHutDepthLimit)|0,t=(g.nodeMatrix[a(e,"y")]-C)/(A-C)*Math.pow(2,g.settings.barnesHutDepthLimit)|0,w[s*v+t]+=1,y[d]=s*v+t;for(c=0,d=0;u>d;d++)c+=w[d],x[d]=c}if(g.settings.barnesHutOptimize);else for(f=0;f<g.nodesLength;f+=g.ppn)for(h=0;h<g.nodesLength;h+=g.ppn)n=g.nodeMatrix[a(f,"x")]-g.nodeMatrix[a(h,"x")],o=g.nodeMatrix[a(f,"y")]-g.nodeMatrix[a(h,"y")],g.settings.adjustSize?(q=Math.sqrt(n*n+o*o)-g.nodeMatrix[a(f,"size")]-g.nodeMatrix[a(h,"size")],q>0?(r=g.settings.scalingRatio*g.nodeMatrix[a(f,"mass")]*g.nodeMatrix[a(h,"mass")]/q/q,g.nodeMatrix[a(f,"dx")]+=n*r,g.nodeMatrix[a(f,"dy")]+=o*r,g.nodeMatrix[a(h,"dx")]+=n*r,g.nodeMatrix[a(h,"dy")]+=o*r):0>q&&(r=100*g.settings.scalingRatio*g.nodeMatrix[a(f,"mass")]*g.nodeMatrix[a(h,"mass")],g.nodeMatrix[a(f,"dx")]+=n*r,g.nodeMatrix[a(f,"dy")]+=o*r,g.nodeMatrix[a(h,"dx")]-=n*r,g.nodeMatrix[a(h,"dy")]-=o*r)):(q=Math.sqrt(n*n+o*o),q>0&&(r=g.settings.scalingRatio*g.nodeMatrix[a(f,"mass")]*g.nodeMatrix[a(h,"mass")]/q/q,g.nodeMatrix[a(f,"dx")]+=n*r,g.nodeMatrix[a(f,"dy")]+=o*r,g.nodeMatrix[a(h,"dx")]-=n*r,g.nodeMatrix[a(h,"dy")]-=o*r));for(k=g.settings.gravity/g.settings.scalingRatio,m=g.settings.scalingRatio,e=0;e<g.nodesLength;e+=g.ppn)n=g.nodeMatrix[a(e,"x")],o=g.nodeMatrix[a(e,"y")],q=Math.sqrt(Math.pow(n,2)+Math.pow(o,2)),g.settings.strongGravityMode?q>0&&(r=m*g.nodeMatrix[a(e,"mass")]*k):q>0&&(r=m*g.nodeMatrix[a(e,"mass")]*k/q);for(g.nodeMatrix[a(e,"dx")]-=n*r,g.nodeMatrix[a(e,"dy")]-=o*r,m=1*(g.settings.outboundAttractionDistribution?l:1),i=0;i<g.edgesLength;i+=g.ppe)f=g.edgeMatrix[b(i,"source")],h=g.edgeMatrix[b(i,"target")],j=g.edgeMatrix[b(i,"weight")],p=0===g.settings.edgeWeightInfluence?1:1===g.settings.edgeWeightInfluence?j:Math.pow(j,g.settings.edgeWeightInfluence),n=g.nodeMatrix[a(f,"x")]-g.nodeMatrix[a(h,"x")],o=g.nodeMatrix[a(f,"y")]-g.nodeMatrix[a(h,"y")],g.settings.adjustSizes?(q=Math.sqrt(Math.pow(n,2)+Math.pow(o,2)-g.nodeMatrix[a(f,"size")]-g.nodeMatrix[a(h,"size")]),g.settings.linLogMode?g.settings.outboundAttractionDistribution?q>0&&(r=-m*p*Math.log(1+q)/q/g.nodeMatrix[a(f,"mass")]):q>0&&(r=-m*p*Math.log(1+q)/q):g.settings.outboundAttractionDistribution?q>0&&(r=-m*p/g.nodeMatrix[a(f,"mass")]):q>0&&(r=-m*p)):(q=Math.sqrt(Math.pow(n,2)+Math.pow(o,2)),g.settings.linLogMode?g.settings.outboundAttractionDistribution?q>0&&(r=-m*p*Math.log(1+q)/q/g.nodeMatrix[a(f,"mass")]):q>0&&(r=-m*p*Math.log(1+q)/q):g.settings.outboundAttractionDistribution?(q=1,r=-m*p/g.nodeMatrix[a(f,"mass")]):(q=1,r=-m*p)),q>0&&(g.nodeMatrix[a(f,"dx")]+=n*r,g.nodeMatrix[a(f,"dy")]+=o*r,g.nodeMatrix[a(h,"dx")]-=n*r,g.nodeMatrix[a(h,"dy")]-=o*r);var D,E,F,G;if(g.settings.adjustSizes)for(e=0;e<g.nodesLength;e+=g.ppn)g.nodeMatrix[a(e,"fixed")]||(D=Math.sqrt(Math.pow(g.nodeMatrix[a(e,"dx")],2)+Math.pow(g.nodeMatrix[a(e,"dy")],2)),D>g.maxForce&&(g.nodeMatrix[a(e,"dx")]=g.nodeMatrix[a(e,"dx")]*maxForce/D,g.nodeMatrix[a(e,"dy")]=g.nodeMatrix[a(e,"dy")]*maxForce/D),E=g.nodeMatrix[a(e,"mass")]*Math.sqrt((g.nodeMatrix[a(e,"old_dx")]-g.nodeMatrix[a(e,"dx")])*(g.nodeMatrix[a(e,"old_dx")]-g.nodeMatrix[a(e,"dx")])+(g.nodeMatrix[a(e,"old_dy")]-g.nodeMatrix[a(e,"dy")])*(g.nodeMatrix[a(e,"old_dy")]-g.nodeMatrix[a(e,"dy")])),F=Math.sqrt((g.nodeMatrix[a(e,"old_dx")]+g.nodeMatrix[a(e,"dx")])*(g.nodeMatrix[a(e,"old_dx")]+g.nodeMatrix[a(e,"dx")])+(g.nodeMatrix[a(e,"old_dy")]+g.nodeMatrix[a(e,"dy")])*(g.nodeMatrix[a(e,"old_dy")]+g.nodeMatrix[a(e,"dy")]))/2,G=.1*Math.log(1+F)/(1+Math.sqrt(E)),g.nodeMatrix[a(e,"x")]=g.nodeMatrix[a(e,"x")]+g.nodeMatrix[a(e,"dx")]*G,g.nodeMatrix[a(e,"y")]=g.nodeMatrix[a(e,"y")]+g.nodeMatrix[a(e,"dy")]*G);else for(e=0;e<g.nodesLength;e+=g.ppn)g.nodeMatrix[a(e,"fixed")]||(E=g.nodeMatrix[a(e,"mass")]*Math.sqrt((g.nodeMatrix[a(e,"old_dx")]-g.nodeMatrix[a(e,"dx")])*(g.nodeMatrix[a(e,"old_dx")]-g.nodeMatrix[a(e,"dx")])+(g.nodeMatrix[a(e,"old_dy")]-g.nodeMatrix[a(e,"dy")])*(g.nodeMatrix[a(e,"old_dy")]-g.nodeMatrix[a(e,"dy")])),F=Math.sqrt((g.nodeMatrix[a(e,"old_dx")]+g.nodeMatrix[a(e,"dx")])*(g.nodeMatrix[a(e,"old_dx")]+g.nodeMatrix[a(e,"dx")])+(g.nodeMatrix[a(e,"old_dy")]+g.nodeMatrix[a(e,"dy")])*(g.nodeMatrix[a(e,"old_dy")]+g.nodeMatrix[a(e,"dy")]))/2,G=g.nodeMatrix[a(e,"convergence")]*Math.log(1+F)/(1+Math.sqrt(E)),g.nodeMatrix[a(e,"convergence")]=Math.min(1,Math.sqrt(G*(Math.pow(g.nodeMatrix[a(e,"dx")],2)+Math.pow(g.nodeMatrix[a(e,"dy")],2))/(1+Math.sqrt(E)))),g.nodeMatrix[a(e,"x")]=g.nodeMatrix[a(e,"x")]+g.nodeMatrix[a(e,"dx")]*G,g.nodeMatrix[a(e,"y")]=g.nodeMatrix[a(e,"y")]+g.nodeMatrix[a(e,"dy")]*G);g.iterations++}function e(){d(),f()}var f,g={ppn:10,ppe:3,ppq:2,maxForce:10,iterations:0,converged:!1,settings:{linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:0,scalingRatio:1,strongGravityMode:!1,gravity:1,barnesHutOptimize:!1,barnesHutTheta:1.2,barnesHutDepthLimit:4}},h={x:0,y:1,dx:2,dy:3,old_dx:4,old_dy:5,mass:6,convergence:7,size:8,fixed:9},i={source:0,target:1,weight:2};f="undefined"!=typeof window&&window.document?function(){var a=new Event("newCoords");a.data={nodes:g.nodeMatrix.buffer},requestAnimationFrame(function(){document.dispatchEvent(a)})}:function(){self.postMessage({nodes:g.nodeMatrix.buffer},[g.nodeMatrix.buffer])},self.addEventListener("message",function(a){switch(a.data.action){case"start":c(new Float32Array(a.data.nodes),new Float32Array(a.data.edges),a.data.config),e();break;case"loop":g.nodeMatrix=new Float32Array(a.data.nodes),e()}})};sigma.prototype.getForceAtlas2Worker=function(){return";("+a(b.toString())+").call(this);"}}.call(this);