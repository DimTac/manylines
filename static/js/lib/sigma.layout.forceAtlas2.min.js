(function(undefined){"use strict";function Supervisor(sigInst,options){var _this=this,workerFn=sigInst.getForceAtlas2Worker();if(window.URL=window.URL||window.webkitURL,this.sigInst=sigInst,this.graph=this.sigInst.graph,this.ppn=10,this.ppe=3,this.started=!1,this.running=!1,webWorkers){var blob=this.makeBlob(workerFn);this.worker=new Worker(URL.createObjectURL(blob)),this.worker.postMessage=this.worker.webkitPostMessage||this.worker.postMessage}else eval(workerFn);var msgName=this.worker?"message":"newCoords";(this.worker||document).addEventListener(msgName,function(t){_this.nodesByteArray=new Float32Array(t.data.nodes),_this.applyLayoutChanges(),_this.running&&_this.sendByteArrayToWorker(),_this.sigInst.refresh()}),this.graphToByteArrays()}if("undefined"==typeof sigma)throw"sigma is not declared";var webWorkers="Worker"in window;Supervisor.prototype.makeBlob=function(t){var e;try{e=new Blob([t],{type:"application/javascript"})}catch(r){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,e=new BlobBuilder,e.append(t),e=e.getBlob()}return e},Supervisor.prototype.graphToByteArrays=function(){var t,e,r,n=this.graph.nodes(),i=this.graph.edges(),o=n.length*this.ppn,a=i.length*this.ppe,s={};for(this.nodesByteArray=new Float32Array(o),this.edgesByteArray=new Float32Array(a),t=e=0,r=n.length;r>t;t++)s[n[t].id]=e,this.nodesByteArray[e]=n[t].x,this.nodesByteArray[e+1]=n[t].y,this.nodesByteArray[e+2]=0,this.nodesByteArray[e+3]=0,this.nodesByteArray[e+4]=0,this.nodesByteArray[e+5]=0,this.nodesByteArray[e+6]=1+this.graph.degree(n[t].id),this.nodesByteArray[e+7]=1,this.nodesByteArray[e+8]=n[t].size,this.nodesByteArray[e+9]=0,e+=this.ppn;for(t=e=0,r=i.length;r>t;t++)this.edgesByteArray[e]=s[i[t].source],this.edgesByteArray[e+1]=s[i[t].target],this.edgesByteArray[e+2]=i[t].weight||0,e+=this.ppe},Supervisor.prototype.applyLayoutChanges=function(){for(var t=this.graph.nodes(),e=0,r=0,n=this.nodesByteArray.length;n>r;r+=this.ppn)t[e].x=this.nodesByteArray[r],t[e].y=this.nodesByteArray[r+1],e++},Supervisor.prototype.sendByteArrayToWorker=function(t){var e={action:t||"loop",nodes:this.nodesByteArray.buffer},r=[this.nodesByteArray.buffer];"start"===t&&(e.config={},e.edges=this.edgesByteArray.buffer,r.push(this.edgesByteArray.buffer)),webWorkers?this.worker.postMessage(e,r):window.postMessage(e,"*")},Supervisor.prototype.start=function(){this.running||(this.running=!0,this.started?this.sendByteArrayToWorker():(this.sendByteArrayToWorker("start"),this.started=!0))},Supervisor.prototype.stop=function(){this.running&&(this.running=!1)},Supervisor.prototype.killWorker=function(){this.worker.terminate()};var supervisor=null;sigma.prototype.startForceAtlas2=function(){return supervisor||(supervisor=new Supervisor(this)),supervisor.start(),this},sigma.prototype.stopForceAtlas2=function(){return supervisor.stop(),this},sigma.prototype.killForceAtlas2=function(){return supervisor.stop(),supervisor.killWorker(),supervisor=null,this}}).call(this),function(){"use strict";if("undefined"==typeof sigma)throw"sigma is not declared";var t=function(){function t(t,e){i.nodeMatrix=t,i.edgeMatrix=e,i.nodesLength=i.nodeMatrix.length,i.edgesLength=i.edgeMatrix.length}function e(){var t,e,r,n,o,a,s,d,M,h,g,p,x,u,y;for(r=0;r<i.nodesLength;r+=i.ppn)i.nodeMatrix[r+4]=i.nodeMatrix[r+2],i.nodeMatrix[r+5]=i.nodeMatrix[r+3],i.nodeMatrix[r+2]=0,i.nodeMatrix[r+3]=0;if(i.settings.outboundAttractionDistribution){for(M=0,r=0;r<i.nodesLength;r+=i.ppn)M+=i.nodeMatrix[r+6];M/=i.nodesLength}if(i.settings.barnesHutOptimize){var l,w,c=Math.pow(2,2*i.settings.barnesHutDepthLimit),f=Math.pow(2,i.settings.barnesHutDepthLimit),A=new UInt16Array(c),b=(new Float32Array(c*i.ppq),new UInt16Array(c)),v=(new UInt16Array(c),new UInt16Array(i.nodesLength)),B=(new UInt16Array(i.nodesLength),0),m=0,k=0,L=0;for(r=0;r<i.nodesLength;r+=i.ppn)B=Math.max(B,i.nodeMatrix[r]),k=Math.min(k,i.nodeMatrix[r]),m=Math.max(m,i.nodeMatrix[r+1]),L=Math.min(L,i.nodeMatrix[r+1]);for(B+=1e-4*(B-k),m+=1e-4*(m-L),r=0,e=0;r<i.nodesLength;r+=i.ppn,e++)l=(i.nodeMatrix[r]-k)/(B-k)*Math.pow(2,i.settings.barnesHutDepthLimit)|0,w=(i.nodeMatrix[r+1]-L)/(m-L)*Math.pow(2,i.settings.barnesHutDepthLimit)|0,A[l*f+w]+=1,v[e]=l*f+w;for(t=0,e=0;c>e;e++)t+=A[e],b[e]=t}if(i.settings.barnesHutOptimize);else for(n=0;n<i.nodesLength;n+=i.ppn)for(o=0;o<i.nodesLength;o+=i.ppn)g=i.nodeMatrix[n]-i.nodeMatrix[o],p=i.nodeMatrix[n+1]-i.nodeMatrix[o+1],i.settings.adjustSize?(u=Math.sqrt(g*g+p*p)-i.nodeMatrix[n+8]-i.nodeMatrix[o+8],u>0?(y=i.settings.scalingRatio*i.nodeMatrix[n+6]*i.nodeMatrix[o+6]/u/u,i.nodeMatrix[n+2]+=g*y,i.nodeMatrix[n+3]+=p*y,i.nodeMatrix[o+2]+=g*y,i.nodeMatrix[o+3]+=p*y):0>u&&(y=100*i.settings.scalingRatio*i.nodeMatrix[n+6]*i.nodeMatrix[o+6],i.nodeMatrix[n+2]+=g*y,i.nodeMatrix[n+3]+=p*y,i.nodeMatrix[o+2]-=g*y,i.nodeMatrix[o+3]-=p*y)):(u=Math.sqrt(g*g+p*p),u>0&&(y=i.settings.scalingRatio*i.nodeMatrix[n+6]*i.nodeMatrix[o+6]/u/u,i.nodeMatrix[n+2]+=g*y,i.nodeMatrix[n+3]+=p*y,i.nodeMatrix[o+2]-=g*y,i.nodeMatrix[o+3]-=p*y));for(d=i.settings.gravity/i.settings.scalingRatio,h=i.settings.scalingRatio,r=0;r<i.nodesLength;r+=i.ppn)g=i.nodeMatrix[r],p=i.nodeMatrix[r+1],u=Math.sqrt(Math.pow(g,2)+Math.pow(p,2)),i.settings.strongGravityMode?u>0&&(y=h*i.nodeMatrix[r+6]*d):u>0&&(y=h*i.nodeMatrix[r+6]*d/u);for(i.nodeMatrix[r+2]-=g*y,i.nodeMatrix[r+3]-=p*y,h=1*(i.settings.outboundAttractionDistribution?M:1),a=0;a<i.edgesLength;a+=i.ppe)n=i.edgeMatrix[a],o=i.edgeMatrix[a+1],s=i.edgeMatrix[a+2],x=0===i.settings.edgeWeightInfluence?1:1===i.settings.edgeWeightInfluence?s:Math.pow(s,i.settings.edgeWeightInfluence),g=i.nodeMatrix[n]-i.nodeMatrix[o],p=i.nodeMatrix[n+1]-i.nodeMatrix[o+1],i.settings.adjustSizes?(u=Math.sqrt(Math.pow(g,2)+Math.pow(p,2)-i.nodeMatrix[n+8]-i.nodeMatrix[o+8]),i.settings.linLogMode?i.settings.outboundAttractionDistribution?u>0&&(y=-h*x*Math.log(1+u)/u/i.nodeMatrix[n+6]):u>0&&(y=-h*x*Math.log(1+u)/u):i.settings.outboundAttractionDistribution?u>0&&(y=-h*x/i.nodeMatrix[n+6]):u>0&&(y=-h*x)):(u=Math.sqrt(Math.pow(g,2)+Math.pow(p,2)),i.settings.linLogMode?i.settings.outboundAttractionDistribution?u>0&&(y=-h*x*Math.log(1+u)/u/i.nodeMatrix[n+6]):u>0&&(y=-h*x*Math.log(1+u)/u):i.settings.outboundAttractionDistribution?(u=1,y=-h*x/i.nodeMatrix[n+6]):(u=1,y=-h*x)),u>0&&(i.nodeMatrix[n+2]+=g*y,i.nodeMatrix[n+3]+=p*y,i.nodeMatrix[o+2]-=g*y,i.nodeMatrix[o+3]-=p*y);var F,W,q,I;if(i.settings.adjustSizes)for(r=0;r<i.nodesLength;r+=i.ppn)i.nodeMatrix[r+9]||(F=Math.sqrt(Math.pow(i.nodeMatrix[r+2],2)+Math.pow(i.nodeMatrix[r+3],2)),F>i.maxForce&&(i.nodeMatrix[r+2]=i.nodeMatrix[r+2]*maxForce/F,i.nodeMatrix[r+3]=i.nodeMatrix[r+3]*maxForce/F),W=i.nodeMatrix[r+6]*Math.sqrt((i.nodeMatrix[r+4]-i.nodeMatrix[r+2])*(i.nodeMatrix[r+4]-i.nodeMatrix[r+2])+(i.nodeMatrix[r+5]-i.nodeMatrix[r+3])*(i.nodeMatrix[r+5]-i.nodeMatrix[r+3])),q=Math.sqrt((i.nodeMatrix[r+4]+i.nodeMatrix[r+2])*(i.nodeMatrix[r+4]+i.nodeMatrix[r+2])+(i.nodeMatrix[r+5]+i.nodeMatrix[r+3])*(i.nodeMatrix[r+5]+i.nodeMatrix[r+3]))/2,I=.1*Math.log(1+q)/(1+Math.sqrt(W)),i.nodeMatrix[r]=i.nodeMatrix[r]+i.nodeMatrix[r+2]*I,i.nodeMatrix[r+1]=i.nodeMatrix[r+1]+i.nodeMatrix[r+3]*I);else for(r=0;r<i.nodesLength;r+=i.ppn)i.nodeMatrix[r+9]||(W=i.nodeMatrix[r+6]*Math.sqrt((i.nodeMatrix[r+4]-i.nodeMatrix[r+2])*(i.nodeMatrix[r+4]-i.nodeMatrix[r+2])+(i.nodeMatrix[r+5]-i.nodeMatrix[r+3])*(i.nodeMatrix[r+5]-i.nodeMatrix[r+3])),q=Math.sqrt((i.nodeMatrix[r+4]+i.nodeMatrix[r+2])*(i.nodeMatrix[r+4]+i.nodeMatrix[r+2])+(i.nodeMatrix[r+5]+i.nodeMatrix[r+3])*(i.nodeMatrix[r+5]+i.nodeMatrix[r+3]))/2,I=i.nodeMatrix[r+7]*Math.log(1+q)/(1+Math.sqrt(W)),i.nodeMatrix[r+7]=Math.min(1,Math.sqrt(I*(Math.pow(i.nodeMatrix[r+2],2)+Math.pow(i.nodeMatrix[r+3],2))/(1+Math.sqrt(W)))),i.nodeMatrix[r]=i.nodeMatrix[r]+i.nodeMatrix[r+2]*I,i.nodeMatrix[r+1]=i.nodeMatrix[r+1]+i.nodeMatrix[r+3]*I);i.iterations++}function r(){e(),n()}var n,i={ppn:10,ppe:3,ppq:2,maxForce:10,iterations:0,converged:!1,settings:{linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:0,scalingRatio:1,strongGravityMode:!1,gravity:1,barnesHutOptimize:!1,barnesHutTheta:1.2,barnesHutDepthLimit:4}};n="undefined"!=typeof window&&window.document?function(){var t=new Event("newCoords");t.data={nodes:i.nodeMatrix.buffer},requestAnimationFrame(function(){document.dispatchEvent(t)})}:function(){self.postMessage({nodes:i.nodeMatrix.buffer},[i.nodeMatrix.buffer])},self.addEventListener("message",function(e){switch(e.data.action){case"start":t(new Float32Array(e.data.nodes),new Float32Array(e.data.edges),e.data.config),r();break;case"loop":i.nodeMatrix=new Float32Array(e.data.nodes),r()}})},e=null;sigma.prototype.getForceAtlas2Worker=function(){var r=e?e(t.toString()):t.toString();return";("+r+").call(this);"}}.call(this);
