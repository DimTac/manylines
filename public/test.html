<!DOCTYPE html>
<html>
<head>
<title>TubeMyNet API testpage</title>
<style type="text/css">
body {
  background: #fefefe;
  font-family: sans-serif;
}
pre {
  white-space: normal;
}
fieldset {
  width: 300px;
  margin: 10px;
  display: inline-block;
  vertical-align: top;
  border: none;
  box-shadow: 1px 1px 12px #555;
}
</style>
</head>
<body>

<section data-section="space">
  <h2>Login / logout a space</h2>

  <fieldset data-method="GET" data-url="/login/:id/:password">
    <h3><code>[GET] /login/:id/:password</code> to <strong>log into an existing space</strong></h3>
    <h4>Form:</h4>
    <div class="form">
      <input type="text" data-mandatory="true" data-field="id" placeholder="id"/>
      <input type="text" data-mandatory="true" data-field="password" placeholder="password"/>
      <button class="call">Call route</button>
    </div>
    <h4>Output:</h4>
    <pre class="output"></pre>
  </fieldset>

  <fieldset data-method="GET" data-url="/logout/:id">
    <h3><code>[GET] /logout/:id</code> to <strong>log out a space</strong></h3>
    <h4>Form:</h4>
    <div class="form">
      <input type="text" data-mandatory="true" data-field="id" placeholder="id"/>
      <button class="call">Call route</button>
    </div>
    <h4>Output:</h4>
    <pre class="output"></pre>
  </fieldset>
</section>

<section data-section="space">
  <h2>Spaces related routes</h2>

  <fieldset data-method="POST" data-url="/space/:email/:password">
    <h3><code>[POST] /space/:email/:password</code> to <strong>create a new space</strong></h3>
    <h4>Form:</h4>
    <div class="form">
      <input type="text" data-mandatory="true" data-field="email" placeholder="email"/>
      <input type="text" data-mandatory="true" data-field="password" placeholder="password"/>
      <button class="call">Call route</button>
    </div>
    <h4>Output:</h4>
    <pre class="output"></pre>
  </fieldset>

  <fieldset data-method="DELETE" data-url="/space/:id">
    <h3><code>[DELETE] /space/:id</code> to <strong>delete an existing space</strong></h3>
    <h4>Form:</h4>
    <div class="form">
      <input type="text" data-mandatory="true" data-field="id" placeholder="id"/>
      <button class="call">Call route</button>
    </div>
    <h4>Output:</h4>
    <pre class="output"></pre>
  </fieldset>
</section>

<section data-section="space">
  <h2>Graph related routes</h2>

  <fieldset data-method="POST" data-url="/graph/last/:id">
    <h3><code>[POST] /graph/last/:id</code> to <strong>update the latest graph of a space</strong></h3>
    <h4>Form:</h4>
    <div class="form">
      <input type="text" data-mandatory="true" data-field="id" placeholder="id"/>
      <input type="text" data-json="true" data-field="graph" placeholder="graph"/>
      <input type="text" data-json="true" data-field="meta" placeholder="meta"/>
      <button class="call">Call route</button>
    </div>
    <h4>Output:</h4>
    <pre class="output"></pre>
  </fieldset>

  <fieldset data-method="GET" data-url="/graph/last/:id">
    <h3><code>[GET] /graph/last/:id</code> to <strong>get the latest graph of a space</strong></h3>
    <h4>Form:</h4>
    <div class="form">
      <input type="text" data-mandatory="true" data-field="id" placeholder="id"/>
      <button class="call">Call route</button>
    </div>
    <h4>Output:</h4>
    <pre class="output"></pre>
  </fieldset>
</section>

<!-- SCRIPTS: -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script>
$(function() {
  var baseURL = '/api',
      baseDOM = $('body');

  $('fieldset', baseDOM).each(function() {
    var dom = $(this),
        url = dom.data('url'),
        data = {},
        toResolve = url.match(/:([^\/]+)/g).map(function(s) {
          return s.substring(1);
        });

    $('.call', dom).click(function() {
      // Resolve URL and data:
      $('*[data-field]', dom).each(function() {
        var dom = $(this),
            val = dom.val(),
            field = dom.data('field');

        if (dom.data('json'))
          val = val ? JSON.parse(val) : null;

        if (!val) {
          if (dom.data('mandatory'))
            throw 'Field "' + field + '" is mandatory.';
          else
            return;
        }

        if (toResolve.indexOf(field) >= 0)
          url = url.replace(':' + field, val);
        else
          data[field] = val;
      });

      $.ajax({
        data: Object.keys(data).length ? JSON.stringify(data) : data,
        url: baseURL + url,
        type: dom.data('method'),
        contentType: 'application/json',
        success: function(data) {
          $('.output', dom).text(JSON.stringify(data));
        },
        error: function(j, t, e) {
          $('.output', dom).text(t + '\n' + e);
        }
      });
    });
  });
});
</script>
</body>
</html>
